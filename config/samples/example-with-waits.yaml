apiVersion: scheduling.example.com/v1alpha1
kind: PodSequence
metadata:
  name: example-with-waits
  namespace: default
spec:
  scope: Cluster
  podGroups:
  - name: "Database"
    pods:
    - postgres-0
    - postgres-1
    # Wait 10 seconds after all DB pods are ready
    # Gives database time to stabilize, create default schemas, etc.
    waitDuration: "10s"
  
  - name: "Cache"
    pods:
    - redis-0
    # Wait 5 seconds for cache to be fully initialized
    waitDuration: "5s"
  
  - name: "Application"
    pods:
    - app-1
    - app-2
    # No wait - app is final tier
---
apiVersion: v1
kind: Pod
metadata:
  name: postgres-0
  namespace: default
spec:
  schedulingGates:
  - name: podsequence.example.com/sequence-gate
  containers:
  - name: postgres
    image: postgres:14
    readinessProbe:
      exec:
        command: ["pg_isready", "-U", "postgres"]
      initialDelaySeconds: 10
      periodSeconds: 5
---
apiVersion: v1
kind: Pod
metadata:
  name: postgres-1
  namespace: default
spec:
  schedulingGates:
  - name: podsequence.example.com/sequence-gate
  containers:
  - name: postgres
    image: postgres:14
    readinessProbe:
      exec:
        command: ["pg_isready", "-U", "postgres"]
      initialDelaySeconds: 10
      periodSeconds: 5
---
apiVersion: v1
kind: Pod
metadata:
  name: redis-0
  namespace: default
spec:
  schedulingGates:
  - name: podsequence.example.com/sequence-gate
  containers:
  - name: redis
    image: redis:7-alpine
    readinessProbe:
      exec:
        command: ["redis-cli", "ping"]
      initialDelaySeconds: 5
      periodSeconds: 5
---
apiVersion: v1
kind: Pod
metadata:
  name: app-1
  namespace: default
spec:
  schedulingGates:
  - name: podsequence.example.com/sequence-gate
  containers:
  - name: app
    image: myapp:latest
    readinessProbe:
      httpGet:
        path: /health
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 10
---
apiVersion: v1
kind: Pod
metadata:
  name: app-2
  namespace: default
spec:
  schedulingGates:
  - name: podsequence.example.com/sequence-gate
  containers:
  - name: app
    image: myapp:latest
    readinessProbe:
      httpGet:
        path: /health
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 10
